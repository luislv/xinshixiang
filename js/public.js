define(["touch/public/js/common"],function(e){function a(e){var a=$.extend({title:"新世相读书会，一年365本书，为你读书，伴你成长",desc:"我们延揽大牛为你暴力拆解好书，提炼不掺水干货，将几十万字内容的精要，压缩在20分钟音频里。听这些就够了。",shareTimelineDesc:"新世相读书会，一年365本书，为你读书，伴你成长",image:"http://resource.thefair.net.cn/_assets/touch/chicken/public/images/share_img.jpg",link:location.origin+"/chicken/page/index?__s="+b,shareAppMessageSuccessCallback:null,shareTimelineSuccessCallback:null},e);v.commonSetWxShareContent(a)}function n(e){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",function(){t(e)},!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",function(){t(e)}),document.attachEvent("onWeixinJSBridgeReady",function(){t(e)})):t(e)}function t(e){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.signInfo.appId,timeStamp:e.signInfo.timeStamp,nonceStr:e.signInfo.nonceStr,"package":e.signInfo["package"],signType:e.signInfo.signType,paySign:e.signInfo.paySign},function(a){var n="";"get_brand_wcpay_request:fail"===a.err_msg||"getBrandWCPayRequest:fail,没有此SDK或暂不支持此SDK模拟"===a.errMsg?(n="fail",e.outTradeNo&&s({url:"/chicken/pay/update_payment_fail",data:{out_trade_no:e.outTradeNo,ext_info:{err_msg:a.err_msg||a.errMsg}}})):"get_brand_wcpay_request:cancel"===a.err_msg?(n="cancel",e.outTradeNo&&s({url:"/chicken/pay/update_payment_cancel",data:{out_trade_no:e.outTradeNo,ext_info:{err_msg:a.err_msg}}})):"get_brand_wcpay_request:ok"===a.err_msg&&(n="success"),e.callback&&e.callback(n)})}function s(e){e.url&&$.ajax({url:e.url,type:e.type||"post",data:e.data||"",dataType:"json",success:function(e){console.log(["统计成功",e])},error:function(e){console.log(["统计失败",e])}})}function i(e,a,n){if(0===$(".public-toast-box").length){var t='<div class="public-toast-box"><i class="toast-icon"></i> <div class="toast-text"></div></div>';$("#scale-wrapper").append(t)}var n=n||2;switch($(".public-toast-box").attr("class","public-toast-box"),e){case"success":$(".public-toast-box").addClass("reserve-success").show();break;case"fail":$(".public-toast-box").addClass("reserve-fail").show()}$(".public-toast-box .toast-text").text(a),clearInterval(x),x=setTimeout(function(){$(".public-toast-box").hide()},1e3*n)}function o(){clearInterval(x),$(".public-toast-box").hide()}function c(e){C=e,e.img_url&&$(".dialog-reserve-mobile  .book-img img").attr("src",e.img_url)}function l(e){e?$(e).each(function(){this.onselectstart=function(e){return e.preventDefault(),event.returnValue=!1,!1},this.onselect=function(e){return e.preventDefault(),event.returnValue=!1,!1},this.oncontextmenu=function(e){return e.preventDefault(),event.returnValue=!1,!1},this.oncopy=function(e){return e.preventDefault(),event.returnValue=!1,!1}}):(document.onselectstart=function(e){return e.preventDefault(),event.returnValue=!1,!1},$("body")[0].onselect=function(){return event.returnValue=!1,!1},$("body")[0].oncontextmenu=function(){return event.returnValue=!1,!1},$("body")[0].oncopy=function(){return event.returnValue=!1,!1})}function r(e){$.ajax({url:"/activity/chicken/payment_status",type:"get",data:{out_trade_no:e,__s:_public.source},dataType:"json",success:function(e){},error:function(e){console.log(e)}})}function d(e){e.match(/__s=/g)||(e.match(/\?/g)?b&&(e=e+"&__s="+b):b&&(e=e+"?__s="+b)),window.location.href=e}function u(e){w=$.extend({displayCheckDialog:!0},e),$.ajax({url:"/chicken/pay/order_confirmation",type:"post",data:e.paymentInfo.params,dataType:"json",success:function(a){if(0===parseInt(a.code)){var n=a.result;n.need_pay?w.displayCheckDialog?(w.item_info={item_name:n.confirmation.item_list[0].item_name,cover_img:n.confirmation.item_list[0].cover_img.url,price:"￥"+(n.confirmation.pay_amount?n.confirmation.pay_amount:n.confirmation.total_amount)},p()):g(w.paymentInfo):g(e.paymentInfo)}},error:function(e){v.commonHandleAjaxError(e)}})}function p(){w=$.extend({autoHide:!0,autoPass:!!k,cancelBtn:!1},w,!0),0===$(".dialog-pay-check").length&&($("#scale-wrapper").append(P),$(".dialog-pay-check .sure-btn").click(function(e){$(this).hasClass("loading")||(w.beforePayment&&w.beforePayment(),g(w.paymentInfo),w.autoHide&&$(".dialog-pay-check").removeClass("show"))}),$(".dialog-pay-check .cancel-btn").click(function(e){w.cancelPayment&&w.cancelPayment(),$(".dialog-pay-check").removeClass("show")}),$(".dialog-pay-check .pass-btn").click(function(e){w.passBtnClick&&w.passBtnClick(),Thefair.addEventGa("dialog_pay","click","become_vip_trigger_of_"+location.pathname),d("/chicken/page/pass_center"),$(".dialog-pay-check").removeClass("show")}),$(".dialog-pay-check").click(function(e){$(e.target).hasClass("dialog-pay-check")&&(w.cancelPayment&&w.cancelPayment(),$(this).removeClass("show"))})),w.item_info&&w.item_info.item_name&&$(".dialog-pay-check .title-text").text("确定购买"+w.item_info.item_name+"？"),w.item_info&&w.item_info.cover_img&&$(".dialog-pay-check .book-img img").attr("src",w.item_info.cover_img),w.item_info&&w.item_info.price&&$(".dialog-pay-check .price .text").text(w.item_info.price),w.passBtnText&&$(".dialog-pay-check .pass-btn").text(w.passBtnText),w.autoPass?$(".dialog-pay-check .pass-btn").show():$(".dialog-pay-check .pass-btn").hide(),w.cancelBtn?$(".dialog-pay-check .cancel-btn").show():$(".dialog-pay-check .cancel-btn").hide(),$(".dialog-pay-check").addClass("show")}function g(e){$.ajax({url:e.url||"/chicken/pay/direct_pay",type:"post",data:e.params,dataType:"json",success:function(a){if(0===parseInt(a.code)){var t=a.result.sign;a.result.need_pay?n({signInfo:t,callback:function(a){switch(a){case"success":i("success","支付成功"),e.success&&e.success(a);break;case"fail":i("fail","支付失败"),e.fail&&e.fail(a);break;case"cancel":i("fail","支付取消"),e.fail&&e.fail(a)}},outTradeNo:a.result.out_trade_no}):e.success&&e.success("not_need_pay")}else e.fail&&e.fail(a),e.errRemind&&v.commonHackAlert(a.message.text);e.finish&&e.finish(a),$(".dialog-pay-check .sure-btn").removeClass("loading")},error:function(a){e.errRemind&&v.commonHandleAjaxError(a),e.finish&&e.finish(a),$(".dialog-pay-check .sure-btn").removeClass("loading")}})}function h(e){var a=$.extend({autoHide:!0},e,!0);0===$(".dialog-not-enough-pay").length&&($("#scale-wrapper").append(S),$(".dialog-not-enough-pay .sure-btn").click(function(e){$(this).hasClass("loading")||(a.beforePayment&&a.beforePayment(),g(a.paymentInfo),a.autoHide&&$(".dialog-not-enough-pay").removeClass("show"))}),$(".dialog-not-enough-pay .cancel-btn").click(function(e){a.cancelPayment&&a.cancelPayment(),$(".dialog-not-enough-pay").removeClass("show")}),$(".dialog-not-enough-pay").click(function(e){$(e.target).hasClass("dialog-not-enough-pay")&&$(this).removeClass("show")})),a.item_info&&a.item_info.price&&$(".dialog-not-enough-pay .need-pay-text").text("还需微信支付：￥"+a.item_info.price),$(".dialog-not-enough-pay").addClass("show")}function m(e){var a=$.extend({autoHide:!0},e,!0);0===$(".dialog-pass-expire").length&&($("#scale-wrapper").append(T),$(".dialog-not-enough-pay .pass-buy-btn").click(function(e){$(this).hasClass("loading")||d("/chicken/page/pass_center")}),$(".dialog-pass-expire").click(function(e){$(e.target).hasClass("dialog-pass-expire")&&$(this).removeClass("show")})),a.avatar&&$(".dialog-pass-expire .avatar").css({"background-image":'url("'+a.avatar+'")'}),$(".dialog-pass-expire").addClass("show")}function f(e){var a=e.status,n="";switch(a){case"play":n='<span class="handle-btn handle-play-btn" data-btn_status="'+a+'"><span class="btn-text">播放</span></span>';break;case"read":n='<span class="handle-btn handle-play-btn" data-btn_status="'+a+'"><span class="btn-text">立即阅读</span></span>';break;case"review":n='<span class="handle-btn handle-play-btn" data-btn_status="'+a+'"><span class="btn-text">复习</span></span>';break;case"direct_pay":n='<span class="handle-btn handle-buy-btn" data-btn_status="'+a+'"><span class="btn-text">购买 ¥'+e.price+"</span></span>";break;case"free":n='<span class="handle-btn handle-buy-btn" data-btn_status="'+a+'" data-method="direct"><span class="btn-text">'+("audio_item"===e.item_type?"免费试听":"免费领取")+"</span></span>";break;case"pass":n='<span class="handle-btn handle-buy-btn" data-btn_status="'+a+'" data-method="direct"><span class="btn-text">￥0.00领取</span></span>'}return n}var v=e,b=$(".hidden-source-value").val();b=b?b:"";var y=$(".hidden-pass_status-value").val(),_=$(".hidden-is_follow_chicken-value").val(),k=$(".hidden-show_pass-value").val();$(".top-icon").click(function(){window.location.href="/activity/chicken/index"}),a();var x=null;$(".public-dialog-container").on("touchmove",function(e){e.stopPropagation(),e.preventDefault()}),$(".public-dialog-container").click(function(e){$(e.target).hasClass("public-dialog-container")&&$(this).hide()}),$(".dialog-reserve-mobile .mobile-input").on("keyup",function(e){var a=$(this).val();v.commonCheckMobileFormat(a)?$(".dialog-reserve-mobile .reserve-btn").removeClass("not"):$(".dialog-reserve-mobile .reserve-btn").addClass("not")});var C=null;$(".dialog-reserve-mobile .dialog-reserve-close").on("click",function(){$(".dialog-reserve-mobile").hide()}),$(".dialog-reserve-mobile .reserve-btn").off("click").click(function(){var e=this;if(!$(e).hasClass("note")&&!$(e).hasClass("loading")){var a=$(".dialog-reserve-mobile .mobile-input").val();if(!v.commonCheckMobileFormat(a))return v.commonHackAlert("请输入正确的11位手机号"),!1;$(e).addClass("loading");var n=$.extend({mobile:a,__s:_public.source},C.data);$.ajax({url:C.url||"/chicken/listen/add_wish",type:"post",dataType:"json",data:n,success:function(a){C.success&&C.success.call(this,a),0==a.code?(i("success","预约成功"),$(".dialog-reserve-mobile").hide()):(v.commonHackAlert(a.message.text),i("fail","预约失败")),$(e).removeClass("loading")},err:function(a){C.error&&C.error.call(this,a),$(e).removeClass("loading"),v.commonHandleAjaxError(a)}})}}),$(".alert-container .go-egg-btn").on("click",function(){$(".alert-container").hide(),$(".public-egg-container").addClass("show");var e=$(".hidden-source-value").val();window.location.href="/activity/chicken/egg?__s="+e}),$(".alert-container .alert-close-icon").on("click",function(){$(".alert-container").hide()});var w=null,P='<div class="dialog-pay-check"><div class="pay-check-box"><div class="book-info"><div class="info"><div class="title-text"></div><div class="price"><span class="text"></span></div></div><div class="book-img"><img></div></div><div class="handle-btn"><div class="btn sure-btn"><span class="btn-text">确定支付</span></div><div class="btn pass-btn">成为会员，免费畅听￥0.00</div><div class="btn cancel-btn">取&nbsp;消</div></div></div></div>',S='<div class="dialog-not-enough-pay"><div class="not-enough-box"><div class="title-text">账户余额不足以完全支付该订单</div><div class="need-pay-text">还需微信支付：￥0</div><div class="handle-btn"><div class="sure-btn"><span class="btn-text">立即支付</span></div></div></div></div>',T='<div class="public-dialog-container dialog-pass-expire"><div class="pass-expire-box"><span class="avatar"></span><span class="text-1">你的会员已到期，续费后播放</span><a class="pass-buy-btn" href="/chicken/page/pass_center">立即开通</a></div></div>';return{source:b,passStatus:y,isFollowChicken:1===parseInt(_),common:e,isWechatBrowser:!!navigator.userAgent.toLowerCase().match(/micromessenger/g),chooseWXPay:n,showToast:i,hideToast:o,analyticsCollect:s,dialogReserveMobileSetting:c,setShareOptions:a,disableCopy:l,updatePaymentStatus:r,pageJump:d,dialogCheckPay:p,dialogNotEnoughPay:h,dialogExpirePass:m,callPayment:u,renderItemListHandleBtnTpl:f}});